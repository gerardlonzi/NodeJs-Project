<%- include('partiel/head', {title: "Profile"}) %>
</head>
<body style="background-color: rgb(0, 9, 41); color:white">
    <%- include('partiel/header') %>
<div>

    <%= message && message.message?message.message : '' %>
    <%= message ? message : '' %>
</div>

<div>
    <% if (typeof course !== 'undefined' && course.length > 0) { %>
        <% course.forEach(element => { %>
            <% if (element.approved ==='wait') { %>
                     <p><i class="bi bi-exclamation-circle"></i> votre cours est cours de v√©rification! <a href="">  A savoir plus sur les r√™gles de validations</a></p>
            <% } else if (element.approved ==='yes') { %>
                <p><i class="bi bi-check-circle"></i></i> v√©rifi√© </p>
                <% } else { %>
                    <p><i class="bi bi-x-circle"></i></i>Non v√©rifi√© </p>
            <% } %>
        <a href="/profile/cours/<%= element.slug %>">
                
            <div>
                <img src="<%= element.thumbail || '' %>" alt="">
                <p><%= element.name ? element.name : '' %></p>
                <p><%= element.user ? element.user.name : 'Inconnu' %></p>
                <p><%= element.prix ? element.prix : '' %></p>
                <p><%= element.courseTime ? element.courseTime : '' %></p>
            </div></a>
        <% }) %>
    <% } %>
</div>

<% if (typeof data !== 'undefined' && data !== null) { %>
    <img class="w-32 h-32" src="<%= data.profilePicture || '' %>" alt="">
    <%- include('partiel/disconnect_logout') %>
    <div>
        <p class="text-red-400">Modifier le profil</p>
        <form action="/profile/update_profile/<%= data.id %>?_method=PUT" enctype="multipart/form-data" method="post">
            <div class="previewPicture">
                <img style="width: 40px; height:40px" src="<%= data.profilePicture || '' %>" alt="" id="previewImage">
                <button class="changeImage">Importer üîΩ</button>
            </div>
            <input class="profil-infos" type="file" name="profilePicture" id="profilePicture" accept="image/*" hidden>
            <input class="profil-infos" type="text" id="name" name="name" value="<%= data.name %>">
            <textarea class="profil-infos" name="aboutYou"><%= data.aboutYou ? data.aboutYou : '' %></textarea>
            <input class="email" type="email" name="email" id="email" value="<%= data.email || '' %>">
            <input class="py-16 password" type="password" name="password" value="          ">
            <input class="profil-infos" type="datetime" name="DateOfBirth" value="<%= data.DateOfBirth ? data.DateOfBirth.toISOString().slice(0,10).replaceAll('-', '/') : '' %>" placeholder="MM-JJ-YY">
            <input class="role" type="text" name="role" id="role" value="<%= data.role || '' %>">
            <input id="submit" type="submit" value="Modifier">
        </form>
    </div>
<% } %>

<%- include('partiel/js') %>
                                <script>
                                    const previewImage = document.querySelector("#previewImage")
                                    const profilePicture = document.querySelector("#profilePicture")
                                    const roleInput = document.querySelector(".role").setAttribute("disabled", "true")
                                    const passwordInput = document.querySelector(".password").setAttribute("disabled", "true")
                                    const emailInput = document.querySelector(".email").setAttribute("disabled", "true")
                                    const submitInput = document.querySelector("#submit")
                                    const changeImage = document.querySelector(".changeImage")
                                    const allInput = document.querySelectorAll(".profil-infos")
                                    submitInput.setAttribute("disabled", "true")
                                    const tab = []
                                    allInput.forEach(el => {
                                        tab.push(el.value)
                                    })
                                    allInput.forEach((el, index) => {
                                        el.addEventListener("input", (e) => {
                                            const value = e.target.value
                                            console.log(value)
                                            if (value !== tab[index]) {
                                                return submitInput.removeAttribute("disabled")
                                            }
                                            submitInput.setAttribute("disabled", "true")

                                        })
                                    })
                                    console.log(tab)
                                    console.log(allInput)
                                    changeImage.addEventListener("click", (e) => {
                                        e.preventDefault()
                                        profilePicture.click()
                                    })
                                    profilePicture.addEventListener('change', (e) => {
                                        const file = e.target.files[0]
                                        console.log(file)
                                        if (file && file.type.startsWith('image/')) {
                                            const reader = new FileReader()
                                            reader.onload = function (e) {
                                                previewImage.src = e.target.result;
                                            }
                                            reader.readAsDataURL(file)
                                        }
                                    })
                                </script>
    </body>

    </html>